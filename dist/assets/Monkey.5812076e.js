import{R as H,r as l,X as h,U as a,a6 as C,V as J,Y as j}from"./index.16d03a80.js";import{w as F}from"./wordTool.7103939f.js";import{R as P,T as Q}from"./ReloadBtn.4d633f60.js";const N=32,Z=8,x=u=>Array.from(u.children),V=u=>{const S=l.exports.useRef(null),i=l.exports.useRef(null),K=l.exports.useRef(null),y=l.exports.useRef(F.getWords(u.$state.root.wordsMode,u.$state.root.customerWords)),p=l.exports.useRef([0,0]),o=l.exports.useRef({wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}}),[O,E]=l.exports.useState(!1),[T,I]=l.exports.useState(!1),[U,v]=l.exports.useState(!1),[b,A]=l.exports.useState(!1),[m,$]=l.exports.useState(""),[d,W]=l.exports.useState([]),[D,M]=l.exports.useState({top:0,left:0}),[B,z]=l.exports.useState(30),k=()=>{const r=p.current,t=i.current.getBoundingClientRect(),e=x(i.current)[r[0]];if(!e)return;const s=Array.from(e.getElementsByClassName("letter"));if(s.length<=r[1]){const n=s[r[1]-1].getBoundingClientRect();M({top:n.top-t.top+2,left:n.left-t.left+n.width})}else{const n=s[r[1]].getBoundingClientRect();M({top:n.top-t.top+2,left:n.left-t.left})}},G=l.exports.useCallback((r,t)=>{const e=p.current,s=m===""||m.charAt(m.length-1)===" ";let n;if(r===N)s?n=e:n=[e[0]+1,0];else{if(e[1]>=d[e[0]].letterArr.length){const c=x(i.current)[e[0]],f=document.createElement("code");f.className="letter wrong extra-letter",f.innerText=t,c.appendChild(f)}n=[e[0],e[1]+1]}p.current=n,k(),W(c=>{const f=c[e[0]].letterArr[e[1]];if(f&&r!==N&&(f.isCorrect=t===f.letter,c[e[0]].letterArr[e[1]]=f),r===N&&!s)if(c[e[0]].letterArr.some(g=>g.isCorrect===null))c[e[0]].isSkip=!0,c[e[0]].isCorrect=!1;else{const L=x(i.current)[e[0]].getElementsByClassName("extra-letter");!L||L.length===0?c[e[0]].isCorrect=c[e[0]].letterArr.every(q=>q.isCorrect):c[e[0]].isCorrect=!1}return(n[0]>c.length-1||e[0]===c.length-1&&e[1]===c[e[0]].letterArr.length-1)&&(c[e[0]].isCorrect=c[e[0]].letterArr.every(g=>g.isCorrect),o.current.right=c.filter(g=>g.isCorrect).length,o.current.wrong=c.length-o.current.right,o.current.acc=Math.round(o.current.right/(o.current.right+o.current.wrong)*100),o.current.time.secs=Math.round((Date.now()-o.current.time.begin)/1e3),o.current.wpm=(o.current.right/(o.current.time.secs/60)).toFixed(2),E(!1),v(!0),setTimeout(()=>{A(!0)},150)),c}),$(c=>r===N&&(c===""||c.charAt(c.length-1)===" ")?c:c+t)},[m,d]),X=l.exports.useCallback(()=>{const r=m.charAt(m.length-1);if(r==="")return;const t=p.current;let e;if(r===" ")if(d[t[0]-1].isCorrect)e=t;else if(d[t[0]-1].isSkip){const s=d[t[0]-1].letterArr.findIndex(n=>n.isCorrect===null);e=[t[0]-1,s]}else{const n=x(i.current)[t[0]-1].getElementsByClassName("letter");e=[t[0]-1,n.length]}else{const s=x(i.current)[t[0]],n=s.getElementsByClassName("extra-letter");n&&n.length>0&&s.removeChild(n[n.length-1]),e=[t[0],t[1]-1]}p.current=e,k(),W(s=>(r===" "?s[t[0]-1].isCorrect===!1&&(s[t[0]-1].isCorrect=null):s[t[0]].letterArr.length>=t[1]&&(s[t[0]].letterArr[t[1]-1].isCorrect=null,s[t[0]].isCorrect=null),s)),$(s=>{let n=!0;return r===" "&&d[t[0]-1].isCorrect&&(n=!1),n?s.substring(0,s.length-1):s})},[m,d]),Y=r=>{r.keyCode!==9&&(r.preventDefault(),r.stopPropagation(),r.persist()),!b&&(I(!1),r.key.length===1?(o.current.time.begin===0&&(o.current.time.begin=Date.now()),G(r.keyCode,r.key)):r.keyCode===Z&&X())},w=()=>{E(!0),S.current.focus()},R=l.exports.useCallback(()=>{p.current=[0,0],y.current=F.shuffle(y.current),o.current={wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}};const r=i.current.getElementsByClassName("extra-letter");r.length!==0&&Array.from(r).forEach(t=>{t.parentNode.removeChild(t)}),W(F.jsonCopy(y.current.slice(0,B)).map(t=>Object.assign({},t,{letterArr:Array.from(t.text).map(e=>({letter:e,isCorrect:null})),isCorrect:null,isSkip:!1}))),$(""),v(!1),A(!1),setTimeout(()=>{w(),k()},10)},[B]);return l.exports.useEffect(()=>{y.current=F.getWords(u.$state.root.wordsMode,u.$state.root.customerWords),R()},[u.$state.root.wordsMode,u.$state.root.customerWords,R,B]),h("div",{className:"Monkey",children:[a("div",{className:"word-count-radio",children:h(C.Group,{value:B,size:"small",onChange:r=>{z(r.target.value)},children:[a(C.Button,{tabIndex:-1,value:20,children:"20"}),a(C.Button,{tabIndex:-1,value:30,children:"30"}),a(C.Button,{tabIndex:-1,value:40,children:"40"}),a(C.Button,{tabIndex:-1,value:50,children:"50"})]})}),h(J,{justify:"center",align:"middle",children:[h(j,{flex:"900px",className:`type-main-box ${U?"fading":""} ${b?"hide":""}`,children:[a("div",{className:`caret ${O?T?"flash":"":"hide"}`,ref:K,style:{transform:`translate3d(${D.left}px,${D.top}px,0)`}}),a("div",{className:"words-box",onClick:w,ref:i,children:d.map((r,t)=>{var e;return h("div",{className:`word ${r.isCorrect?"correct":r.isCorrect===!1?"wrong":""}`,children:[a("div",{className:"label",children:r.label}),(e=r.letterArr)==null?void 0:e.map((s,n)=>a("code",{className:`letter ${s.isCorrect?"correct":s.isCorrect===!1?"wrong":""}`,children:s.letter},`${t}_${n}`))]},t)})}),a("input",{className:"hidden-input",type:"text",ref:S,onKeyDown:Y,onBlur:()=>{E(!1)},onFocus:()=>{E(!0),I(!0)}}),a("div",{className:"reload-line",children:a(P,{onClick:R})}),h("div",{className:`tip-line ${T?"":"hide"}`,children:[a("div",{children:"\u70B9\u51FB\u8BCD\u5757\u8FDB\u5165\u8F93\u5165\u72B6\u6001"}),a("div",{children:"\u8F93\u5165\u6B63\u786E\u7684\u62FC\u97F3\u5B57\u6BCD\uFF0C\u7136\u540E\u7A7A\u683C"}),h("div",{children:["\u8F93\u5165\u72B6\u6001\u4E0B",a("code",{children:"Tab"}),"\u540E\u56DE\u8F66\u53EF\u4EE5\u76F4\u63A5\u5237\u65B0"]})]})]}),h(j,{flex:"900px",className:`type-result-box ${b?"show":""}`,children:[a(Q,{desc:"WPM",numStr:o.current.wpm,acc:o.current.acc,secs:o.current.time.secs}),a("div",{className:"reload-line",children:a(P,{onClick:R})})]})]})]})};var re=H(V);export{re as default};
